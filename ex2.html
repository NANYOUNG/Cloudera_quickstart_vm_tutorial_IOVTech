<html>


<head>

  <title>Tutorial Exercise 2</title>

</head>





<body>
<font face="Arial" size="5">

<b>Tutorial Exercise 2</b> </font><br><br>

<font face="Arial" size="3">


You'll use Hue.<br>
Hue is Graphical user interface for users of the cluster.

<p><img width="740" height="506" title="ex2_1.PNG" align="" class="__se_object" id="se_object_142278740760595790" style="border: 1px solid rgb(0, 0, 0); border-image: none; width: 740px; height: 506px; rwidth: 740px; rheight: 506px;" src="http://blogfiles.naver.net/20150201_212/ryuhyekyung_1422787406925KVEzm_PNG/ex2_1.PNG" border="1" rwidth="740" rheight="506" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment" sqeid="QE_142278740965319799"><br></p>

<p>
Let's start Hue!
Click 'Fire Fox Icon'.
</p>

<p><img width="740" height="445" title="ex2_2.png" align="" class="__se_object" id="se_object_142278753565783269" style="border-color: rgb(0, 0, 0); width: 740px; height: 445px; rwidth: 740px; rheight: 445px;" src="http://blogfiles.naver.net/20150201_44/ryuhyekyung_1422787534881WI1lo_PNG/ex2_2.png" rwidth="740" rheight="445" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment" sqeid="QE_142278753724469865"></p><p><br></p>


It¡¯s ¡®quickstart.cloudera¡¯ web page. <br>
Click ¡®Hue¡¯. <br>
Then Hue will be started.<br><br>


<p><img width="740" height="445" title="ex2_3.png" align="" class="__se_object" id="se_object_142278763459669373" style="border-color: rgb(0, 0, 0); width: 740px; height: 445px; rwidth: 740px; rheight: 445px;" src="http://blogfiles.naver.net/20150201_269/ryuhyekyung_1422787633853F0d2G_PNG/ex2_3.png" rwidth="740" rheight="445" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment" sqeid="QE_14227876358836660"><br></p>

You'll use Hue to run some SQL queries against the data. <br>
Hue provides a web-based interface for many of the tools in CDH.<br><br>


<p><img width="740" height="443" title="ex2_4.PNG" align="" class="__se_object" id="se_object_142278770795271548" style="width: 740px; height: 443px; rwidth: 740px; rheight: 443px;" src="http://blogfiles.naver.net/20150201_288/ryuhyekyung_1422787707227AACAD_PNG/ex2_4.PNG" rwidth="740" rheight="443" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"></p><p><br></p>

In the QuickStart VM, the administrator username for Hue is 'cloudera' and the password is 'cloudera'.<p>



<img width="740" height="541" title="ex2_5.PNG" align="" class="__se_object" id="se_object_142278793196139100" style="width: 740px; height: 541px; rwidth: 740px; rheight: 541px;" src="http://blogfiles.naver.net/20150201_294/ryuhyekyung_1422787931245qIQGc_PNG/ex2_5.PNG" rwidth="740" rheight="541" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;">



Once you are inside of Hue, click of Query Editors, and open the Impala Query Editor. <p>

<br style="clear: both;"><img width="740" height="526" title="ex2_6.png" align="" class="__se_object" id="se_object_142278793224034709" style="width: 740px; height: 526px; rwidth: 740px; rheight: 526px;" src="http://blogfiles.naver.net/20150201_221/ryuhyekyung_1422787931496WVTxI_PNG/ex2_6.png" rwidth="740" rheight="526" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;"><br style="clear: both;">

You'll notice that the tables that we created in Hive are not available in Impala yet. <br>
This is because we created them outside of Impala, and Impala does not constantly check for changes to the table metadata. <p>


<img width="740" height="539" title="ex2_7.png" align="" class="__se_object" id="se_object_142278793249869077" style="width: 740px; height: 539px; rwidth: 740px; rheight: 539px;" src="http://blogfiles.naver.net/20150201_59/ryuhyekyung_1422787931786gYV3a_PNG/ex2_7.png" rwidth="740" rheight="539" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;"><br style="clear: both;">

To get our tables to display, paste the following into the query editor and hit Execute.<p>


<table style="border: 0.28pt solid rgb(0, 0, 0); border-image: none; border-collapse: collapse; mso-table-overlap: never;">
<tr>
<td valign="top" style="background: rgb(242, 242, 242); padding: 1.41pt 5.1pt; border: 0.28pt solid rgb(0, 0, 0); border-image: none; width: 600pt; height: 20pt;">

invalidate metadata

</td>
</tr></table>

<br><br>

<img width="740" height="524" title="ex2_8.png" align="" class="__se_object" id="se_object_142278793272871555" style="width: 740px; height: 524px; rwidth: 740px; rheight: 524px;" src="http://blogfiles.naver.net/20150201_190/ryuhyekyung_1422787931997OqQuv_PNG/ex2_8.png" rwidth="740" rheight="524" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;"><br style="clear: both;">

<table style="border: 0.28pt solid rgb(0, 0, 0); border-image: none; border-collapse: collapse; mso-table-overlap: never;">
<tr>
<td valign="top" style="background: rgb(242, 242, 242); padding: 1.41pt 5.1pt; border: 0.28pt solid rgb(0, 0, 0); border-image: none; width: 600pt; height: 115pt;">

"invalidate metadata" statement
: Marks the metadata for one or all tables as stale. Required after a table is created through the Hive shell, before the table is available for Impala queries. The next time the current Impala node performs a query against a table whose metadata is invalidated, Impala reloads the associated metadata before the query proceeds. This is a relatively expensive operation compared to the incremental metadata update done by the REFRESH statement, so in the common scenario of adding new data files to an existing table, prefer REFRESH rather than INVALIDATE METADATA. If you are not familiar with the way Impala uses metadata and how it shares the same metastore database as Hive, see Overview of Impala Metadata and the Metastore for background information.

</td>
</tr></table>

<p>

Now, you click on the "Refresh Table List" icon.
<p>

<img width="740" height="525" title="ex2_9.png" align="" class="__se_object" id="se_object_142278793314436024" style="width: 740px; height: 525px; rwidth: 740px; rheight: 525px;" src="http://blogfiles.naver.net/20150201_5/ryuhyekyung_1422787932253CQNSB_PNG/ex2_9.png" rwidth="740" rheight="525" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;"><br style="clear: both;">

You will see your new tables.<p>


<img width="740" height="529" title="ex2_10.png" align="" class="__se_object" id="se_object_142278793361672157" style="width: 740px; height: 529px; rwidth: 740px; rheight: 529px;" src="http://blogfiles.naver.net/20150201_34/ryuhyekyung_1422787932710QwKYr_PNG/ex2_10.png" rwidth="740" rheight="529" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;"><br style="clear: both;">

Copy and paste or type in the following standard SQL example queries for calculating total revenue per product and showing the top 10 revenue generating products : 
<p>

<table style="border: 0.28pt solid rgb(0, 0, 0); border-image: none; border-collapse: collapse; mso-table-overlap: never;">
<tr>
<td valign="top" style="background: rgb(242, 242, 242); padding: 1.41pt 5.1pt; border: 0.28pt solid rgb(0, 0, 0); border-image: none; width: 600pt; height: 115pt;">

-- Most popular product categories <br>
select c.category_name, count(order_item_quantity) as count <br>
from order_items oi <br>
inner join products p on oi.order_item_product_id = p.product_id <br>
inner join categories c on c.category_id = p.product_category_id <br>
group by c.category_name <br>
order by count desc <br>
limit 10;

</td>
</tr></table>

<p>
<br><br>
Hit Execute. <p>

<img width="740" height="542" title="ex2_11.png" align="" class="__se_object" id="se_object_142278793396542741" style="width: 740px; height: 542px; rwidth: 740px; rheight: 542px;" src="http://blogfiles.naver.net/20150201_152/ryuhyekyung_1422787933223pUgaA_PNG/ex2_11.png" rwidth="740" rheight="542" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;"><br style="clear: both;">

You should see results of the following form :<p>

<img width="740" height="541" title="ex2_12.png" align="" class="__se_object" id="se_object_142278793425360579" style="width: 740px; height: 541px; rwidth: 740px; rheight: 541px;" src="http://blogfiles.naver.net/20150201_123/ryuhyekyung_1422787933567r8q7i_PNG/ex2_12.png" rwidth="740" rheight="541" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;"><br style="clear: both;">

Clear out the previous query. <p>

<img width="740" height="372" title="ex2_13.png" align="" class="__se_object" id="se_object_14227879345662793" style="width: 740px; height: 372px; rwidth: 740px; rheight: 372px;" src="http://blogfiles.naver.net/20150201_235/ryuhyekyung_1422787933849ud9Pb_PNG/ex2_13.png" rwidth="740" rheight="372" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;"><br style="clear: both;">

Copy and paste or type in the following standard SQL example queries : <p>

<table style="border: 0.28pt solid rgb(0, 0, 0); border-image: none; border-collapse: collapse; mso-table-overlap: never;">
<tr>
<td valign="top" style="background: rgb(242, 242, 242); padding: 1.41pt 5.1pt; border: 0.28pt solid rgb(0, 0, 0); border-image: none; width: 600pt; height: 130.93pt;">

-- top 10 revenue generating products <br>
select p.product_id, p.product_name, r.revenue <br>
from products p inner join <br>
(select oi.order_item_product_id, sum(cast(oi.order_item_subtotal as float)) <br>as revenue <br>
from order_items oi inner join orders o <br>
on oi.order_item_order_id = o.order_id <br>
where o.order_status <> 'CANCELED' <br>
and o.order_status <> 'SUSPECTED_FRAUD' <br>
group by order_item_product_id) r <br>
on p.product_id = r.order_item_product_id <br>
order by r.revenue desc <br>
limit 10;

</td>
</tr></table>


<img width="740" height="369" title="ex2_14.png" align="" class="__se_object" id="se_object_142278793484317040" style="width: 740px; height: 369px; rwidth: 740px; rheight: 369px;" src="http://blogfiles.naver.net/20150201_45/ryuhyekyung_1422787934149Cri9q_PNG/ex2_14.png" rwidth="740" rheight="369" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br style="clear: both;"><br style="clear: both;">

You should see results similar to this : 
<p>

<img width="740" height="374" title="ex2_15.png" align="" class="__se_object" id="se_object_142278793514677689" style="width: 740px; height: 374px; rwidth: 740px; rheight: 374px;" src="http://blogfiles.naver.net/20150201_85/ryuhyekyung_1422787934368evARN_PNG/ex2_15.png" rwidth="740" rheight="374" jsonvalue="%7B%7D" imgqe="true" s_subtype="photo" s_type="attachment"><br></p>
If one of these steps fails, please reach out to our Cloudera Live Forum and get help. Otherwise continue.
<p>

<b>CONCLUSION</b> <br>
Now you have learned how to query Hive tables using Impala and that you can use regular interfaces and tools (such as SQL) within a Hadoop environment as well. 
The idea here being that you can do the same reports you usually do, but where the architecture of Hadoop vs traditional systems provides much larger scale and flexibility.
<p>
</body>





</html>


